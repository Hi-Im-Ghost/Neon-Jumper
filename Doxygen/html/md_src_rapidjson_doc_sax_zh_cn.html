<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Neon Jumper: SAX</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Neon Jumper<span id="projectnumber">&#160;1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SAX </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >"SAX" 此术语源于 <a href="http://en.wikipedia.org/wiki/Simple_API_for_XML">Simple API for XML</a>。我们借了此术语去套用在 JSON 的解析及生成。</p>
<p >在 RapidJSON 中，<code>Reader</code>（<code><a class="el" href="class_generic_reader.html" title="SAX-style JSON parser. Use Reader for UTF8 encoding and default allocator.">GenericReader</a>&lt;...&gt;</code> 的 typedef）是 JSON 的 SAX 风格解析器，而 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code>（<code>GenericWriter&lt;...&gt;</code> 的 typedef）则是 JSON 的 SAX 风格生成器。</p>
<h1><a class="anchor" id="Reader"></a>
Reader</h1>
<p ><code>Reader</code> 从输入流解析一个 JSON。当它从流中读取字符时，它会基于 JSON 的语法去分析字符，并向处理器发送事件。</p>
<p >例如，以下是一个 JSON。</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;hello&quot;: &quot;world&quot;,</div>
<div class="line">    &quot;t&quot;: true ,</div>
<div class="line">    &quot;f&quot;: false,</div>
<div class="line">    &quot;n&quot;: null,</div>
<div class="line">    &quot;i&quot;: 123,</div>
<div class="line">    &quot;pi&quot;: 3.1416,</div>
<div class="line">    &quot;a&quot;: [1, 2, 3, 4]</div>
<div class="line">}</div>
</div><!-- fragment --><p >当一个 <code>Reader</code> 解析此 JSON 时，它会顺序地向处理器发送以下的事件：</p>
<div class="fragment"><div class="line">StartObject()</div>
<div class="line">Key(&quot;hello&quot;, 5, true)</div>
<div class="line">String(&quot;world&quot;, 5, true)</div>
<div class="line">Key(&quot;t&quot;, 1, true)</div>
<div class="line">Bool(true)</div>
<div class="line">Key(&quot;f&quot;, 1, true)</div>
<div class="line">Bool(false)</div>
<div class="line">Key(&quot;n&quot;, 1, true)</div>
<div class="line">Null()</div>
<div class="line">Key(&quot;i&quot;)</div>
<div class="line">Uint(123)</div>
<div class="line">Key(&quot;pi&quot;)</div>
<div class="line">Double(3.1416)</div>
<div class="line">Key(&quot;a&quot;)</div>
<div class="line">StartArray()</div>
<div class="line">Uint(1)</div>
<div class="line">Uint(2)</div>
<div class="line">Uint(3)</div>
<div class="line">Uint(4)</div>
<div class="line">EndArray(4)</div>
<div class="line">EndObject(7)</div>
</div><!-- fragment --><p >除了一些事件参数需要再作解释，这些事件可以轻松地与 JSON 对上。我们可以看看 <code>simplereader</code> 例子怎样产生和以上完全相同的结果：</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reader_8h.html">rapidjson/reader.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a>;</div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="struct_my_handler.html">MyHandler</a> : <span class="keyword">public</span> <a class="code hl_struct" href="struct_base_reader_handler.html">BaseReaderHandler</a>&lt;UTF8&lt;&gt;, MyHandler&gt; {</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a73b14891ee0ab44fc336b3e2044e3153">Null</a>() { cout &lt;&lt; <span class="stringliteral">&quot;Null()&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a29eeca8918d0966a0551adb23c8a2b15">Bool</a>(<span class="keywordtype">bool</span> b) { cout &lt;&lt; <span class="stringliteral">&quot;Bool(&quot;</span> &lt;&lt; boolalpha &lt;&lt; b &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#aa7cda8307f15dd8f4a09947e527d56cf">Int</a>(<span class="keywordtype">int</span> i) { cout &lt;&lt; <span class="stringliteral">&quot;Int(&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a469684e51df996bab87e0c22c0ea64fd">Uint</a>(<span class="keywordtype">unsigned</span> u) { cout &lt;&lt; <span class="stringliteral">&quot;Uint(&quot;</span> &lt;&lt; u &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a5676446b090d3c71386aec6a39dbb188">Int64</a>(<a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> i) { cout &lt;&lt; <span class="stringliteral">&quot;Int64(&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a87b2d8341b4e3a38d405a89fe0d848ad">Uint64</a>(<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> u) { cout &lt;&lt; <span class="stringliteral">&quot;Uint64(&quot;</span> &lt;&lt; u &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a5ff39ea10f682eab1943480b020c6f5a">Double</a>(<span class="keywordtype">double</span> d) { cout &lt;&lt; <span class="stringliteral">&quot;Double(&quot;</span> &lt;&lt; d &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a5f46e8498869668d70e23453126a7b12">String</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy) { </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;String(&quot;</span> &lt;&lt; str &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; boolalpha &lt;&lt; copy &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#afc0da4321f0a06e3cd351e573c435ffe">StartObject</a>() { cout &lt;&lt; <span class="stringliteral">&quot;StartObject()&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#afca1a3a16289baf03128fa7d63081526">Key</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy) { </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Key(&quot;</span> &lt;&lt; str &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; boolalpha &lt;&lt; copy &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a3eb4011dcba95939e5f08e71c1596395">EndObject</a>(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> memberCount) { cout &lt;&lt; <span class="stringliteral">&quot;EndObject(&quot;</span> &lt;&lt; memberCount &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a1e794a6439658520bda0de14f661fc50">StartArray</a>() { cout &lt;&lt; <span class="stringliteral">&quot;StartArray()&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_my_handler.html#a8654e16efc52d41397ce1a9af98bcb80">EndArray</a>(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> elementCount) { cout &lt;&lt; <span class="stringliteral">&quot;EndArray(&quot;</span> &lt;&lt; elementCount &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl; <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> json[] = <span class="stringliteral">&quot; { \&quot;hello\&quot; : \&quot;world\&quot;, \&quot;t\&quot; : true , \&quot;f\&quot; : false, \&quot;n\&quot;: null, \&quot;i\&quot;:123, \&quot;pi\&quot;: 3.1416, \&quot;a\&quot;:[1, 2, 3, 4] } &quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="struct_my_handler.html">MyHandler</a> handler;</div>
<div class="line">    <a class="code hl_class" href="class_generic_reader.html">Reader</a> reader;</div>
<div class="line">    <a class="code hl_struct" href="struct_generic_string_stream.html">StringStream</a> ss(json);</div>
<div class="line">    reader.<a class="code hl_function" href="class_generic_reader.html#a0c450620d14ff1824e58bb7bd9b42099">Parse</a>(ss, handler);</div>
<div class="line">}</div>
<div class="ttc" id="a_c_make_c_compiler_id_8c_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> CMakeCCompilerId.c:726</div></div>
<div class="ttc" id="aclass_generic_reader_html"><div class="ttname"><a href="class_generic_reader.html">GenericReader&lt; UTF8&lt; char &gt;, UTF8&lt; char &gt;, CrtAllocator &gt;</a></div></div>
<div class="ttc" id="aclass_generic_reader_html_a0c450620d14ff1824e58bb7bd9b42099"><div class="ttname"><a href="class_generic_reader.html#a0c450620d14ff1824e58bb7bd9b42099">GenericReader::Parse</a></div><div class="ttdeci">ParseResult Parse(InputStream &amp;is, Handler &amp;handler)</div><div class="ttdoc">Parse JSON text.</div><div class="ttdef"><b>Definition:</b> reader.h:559</div></div>
<div class="ttc" id="anamespacerapidjson_html"><div class="ttname"><a href="namespacerapidjson.html">rapidjson</a></div><div class="ttdoc">main RapidJSON namespace</div></div>
<div class="ttc" id="arapidjson_8h_html_a5ed6e6e67250fadbd041127e6386dcb5"><div class="ttname"><a href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a></div><div class="ttdeci">RAPIDJSON_NAMESPACE_BEGIN typedef unsigned SizeType</div><div class="ttdoc">Size type (for string lengths, array sizes, etc.)</div><div class="ttdef"><b>Definition:</b> rapidjson.h:415</div></div>
<div class="ttc" id="areader_8h_html"><div class="ttname"><a href="reader_8h.html">reader.h</a></div></div>
<div class="ttc" id="astdint_8h_html_a414156feea104f8f75b4ed9e3121b2f6"><div class="ttname"><a href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a></div><div class="ttdeci">signed __int64 int64_t</div><div class="ttdef"><b>Definition:</b> stdint.h:135</div></div>
<div class="ttc" id="astdint_8h_html_aec6fcb673ff035718c238c8c9d544c47"><div class="ttname"><a href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a></div><div class="ttdeci">unsigned __int64 uint64_t</div><div class="ttdef"><b>Definition:</b> stdint.h:136</div></div>
<div class="ttc" id="astruct_base_reader_handler_html"><div class="ttname"><a href="struct_base_reader_handler.html">BaseReaderHandler</a></div><div class="ttdoc">Default implementation of Handler.</div><div class="ttdef"><b>Definition:</b> reader.h:198</div></div>
<div class="ttc" id="astruct_generic_string_stream_html"><div class="ttname"><a href="struct_generic_string_stream.html">GenericStringStream</a></div><div class="ttdoc">Read-only string stream.</div><div class="ttdef"><b>Definition:</b> stream.h:154</div></div>
<div class="ttc" id="astruct_my_handler_html"><div class="ttname"><a href="struct_my_handler.html">MyHandler</a></div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:15</div></div>
<div class="ttc" id="astruct_my_handler_html_a1e794a6439658520bda0de14f661fc50"><div class="ttname"><a href="struct_my_handler.html#a1e794a6439658520bda0de14f661fc50">MyHandler::StartArray</a></div><div class="ttdeci">bool StartArray()</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:33</div></div>
<div class="ttc" id="astruct_my_handler_html_a29eeca8918d0966a0551adb23c8a2b15"><div class="ttname"><a href="struct_my_handler.html#a29eeca8918d0966a0551adb23c8a2b15">MyHandler::Bool</a></div><div class="ttdeci">bool Bool(bool b)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:22</div></div>
<div class="ttc" id="astruct_my_handler_html_a3eb4011dcba95939e5f08e71c1596395"><div class="ttname"><a href="struct_my_handler.html#a3eb4011dcba95939e5f08e71c1596395">MyHandler::EndObject</a></div><div class="ttdeci">bool EndObject(SizeType memberCount)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:32</div></div>
<div class="ttc" id="astruct_my_handler_html_a469684e51df996bab87e0c22c0ea64fd"><div class="ttname"><a href="struct_my_handler.html#a469684e51df996bab87e0c22c0ea64fd">MyHandler::Uint</a></div><div class="ttdeci">bool Uint(unsigned u)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:24</div></div>
<div class="ttc" id="astruct_my_handler_html_a5676446b090d3c71386aec6a39dbb188"><div class="ttname"><a href="struct_my_handler.html#a5676446b090d3c71386aec6a39dbb188">MyHandler::Int64</a></div><div class="ttdeci">bool Int64(int64_t i)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:25</div></div>
<div class="ttc" id="astruct_my_handler_html_a5f46e8498869668d70e23453126a7b12"><div class="ttname"><a href="struct_my_handler.html#a5f46e8498869668d70e23453126a7b12">MyHandler::String</a></div><div class="ttdeci">bool String(const char *str, SizeType length, bool)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:29</div></div>
<div class="ttc" id="astruct_my_handler_html_a5ff39ea10f682eab1943480b020c6f5a"><div class="ttname"><a href="struct_my_handler.html#a5ff39ea10f682eab1943480b020c6f5a">MyHandler::Double</a></div><div class="ttdeci">bool Double(double d)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:27</div></div>
<div class="ttc" id="astruct_my_handler_html_a73b14891ee0ab44fc336b3e2044e3153"><div class="ttname"><a href="struct_my_handler.html#a73b14891ee0ab44fc336b3e2044e3153">MyHandler::Null</a></div><div class="ttdeci">bool Null()</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:21</div></div>
<div class="ttc" id="astruct_my_handler_html_a8654e16efc52d41397ce1a9af98bcb80"><div class="ttname"><a href="struct_my_handler.html#a8654e16efc52d41397ce1a9af98bcb80">MyHandler::EndArray</a></div><div class="ttdeci">bool EndArray(SizeType elementCount)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:34</div></div>
<div class="ttc" id="astruct_my_handler_html_a87b2d8341b4e3a38d405a89fe0d848ad"><div class="ttname"><a href="struct_my_handler.html#a87b2d8341b4e3a38d405a89fe0d848ad">MyHandler::Uint64</a></div><div class="ttdeci">bool Uint64(uint64_t u)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:26</div></div>
<div class="ttc" id="astruct_my_handler_html_aa7cda8307f15dd8f4a09947e527d56cf"><div class="ttname"><a href="struct_my_handler.html#aa7cda8307f15dd8f4a09947e527d56cf">MyHandler::Int</a></div><div class="ttdeci">bool Int(int i)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:23</div></div>
<div class="ttc" id="astruct_my_handler_html_afc0da4321f0a06e3cd351e573c435ffe"><div class="ttname"><a href="struct_my_handler.html#afc0da4321f0a06e3cd351e573c435ffe">MyHandler::StartObject</a></div><div class="ttdeci">bool StartObject()</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:30</div></div>
<div class="ttc" id="astruct_my_handler_html_afca1a3a16289baf03128fa7d63081526"><div class="ttname"><a href="struct_my_handler.html#afca1a3a16289baf03128fa7d63081526">MyHandler::Key</a></div><div class="ttdeci">bool Key(const char *str, SizeType length, bool)</div><div class="ttdef"><b>Definition:</b> simplepullreader.cpp:31</div></div>
</div><!-- fragment --><p >注意 RapidJSON 使用模板去静态挷定 <code>Reader</code> 类型及处理器的类型，而不是使用含虚函数的类。这个范式可以通过把函数内联而改善性能。</p>
<h2><a class="anchor" id="Handler"></a>
Handler</h2>
<p >如前例所示，使用者需要实现一个处理器（handler），用于处理来自 <code>Reader</code> 的事件（函数调用）。处理器必须包含以下的成员函数。</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="classrapidjson_1_1_handler.html">Handler</a> {</div>
<div class="line">    <span class="keywordtype">bool</span> Null();</div>
<div class="line">    <span class="keywordtype">bool</span> Bool(<span class="keywordtype">bool</span> b);</div>
<div class="line">    <span class="keywordtype">bool</span> Int(<span class="keywordtype">int</span> i);</div>
<div class="line">    <span class="keywordtype">bool</span> Uint(<span class="keywordtype">unsigned</span> i);</div>
<div class="line">    <span class="keywordtype">bool</span> Int64(<a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> i);</div>
<div class="line">    <span class="keywordtype">bool</span> Uint64(<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> i);</div>
<div class="line">    <span class="keywordtype">bool</span> Double(<span class="keywordtype">double</span> d);</div>
<div class="line">    <span class="keywordtype">bool</span> RawNumber(<span class="keyword">const</span> Ch* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy);</div>
<div class="line">    <span class="keywordtype">bool</span> String(<span class="keyword">const</span> Ch* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy);</div>
<div class="line">    <span class="keywordtype">bool</span> StartObject();</div>
<div class="line">    <span class="keywordtype">bool</span> Key(<span class="keyword">const</span> Ch* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy);</div>
<div class="line">    <span class="keywordtype">bool</span> EndObject(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> memberCount);</div>
<div class="line">    <span class="keywordtype">bool</span> StartArray();</div>
<div class="line">    <span class="keywordtype">bool</span> EndArray(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> elementCount);</div>
<div class="line">};</div>
<div class="ttc" id="aclassrapidjson_1_1_handler_html"><div class="ttname"><a href="classrapidjson_1_1_handler.html">Handler</a></div><div class="ttdoc">Concept for receiving events from GenericReader upon parsing. The functions return true if no error o...</div></div>
</div><!-- fragment --><p >当 <code>Reader</code> 遇到 JSON null 值时会调用 <code>Null()</code>。</p>
<p >当 <code>Reader</code> 遇到 JSON true 或 false 值时会调用 <code>Bool(bool)</code>。</p>
<p >当 <code>Reader</code> 遇到 JSON number，它会选择一个合适的 C++ 类型映射，然后调用 <code>Int(int)</code>、<code>Uint(unsigned)</code>、<code>Int64(int64_t)</code>、<code>Uint64(uint64_t)</code> 及 <code>Double(double)</code> 的 * 其中之一个 *。 若开启了 <code>kParseNumbersAsStrings</code> 选项，<code>Reader</code> 便会改为调用 <code>RawNumber()</code>。</p>
<p >当 <code>Reader</code> 遇到 JSON string，它会调用 <code>String(const char* str, SizeType length, bool copy)</code>。第一个参数是字符串的指针。第二个参数是字符串的长度（不包含空终止符号）。注意 RapidJSON 支持字串中含有空字符 <code>\0</code>。若出现这种情况，便会有 <code>strlen(str) &lt; length</code>。最后的 <code>copy</code> 参数表示处理器是否需要复制该字符串。在正常解析时，<code>copy = true</code>。仅当使用原位解析时，<code>copy = false</code>。此外，还要注意字符的类型与目标编码相关，我们稍后会再谈这一点。</p>
<p >当 <code>Reader</code> 遇到 JSON object 的开始之时，它会调用 <code>StartObject()</code>。JSON 的 object 是一个键值对（成员）的集合。若 object 包含成员，它会先为成员的名字调用 <code>Key()</code>，然后再按值的类型调用函数。它不断调用这些键值对，直至最终调用 <code>EndObject(SizeType memberCount)</code>。注意 <code>memberCount</code> 参数对处理器来说只是协助性质，使用者可能不需要此参数。</p>
<p >JSON array 与 object 相似，但更简单。在 array 开始时，<code>Reader</code> 会调用 <code>BeginArary()</code>。若 array 含有元素，它会按元素的类型来读用函数。相似地，最后它会调用 <code>EndArray(SizeType elementCount)</code>，其中 <code>elementCount</code> 参数对处理器来说只是协助性质。</p>
<p >每个处理器函数都返回一个 <code>bool</code>。正常它们应返回 <code>true</code>。若处理器遇到错误，它可以返回 <code>false</code> 去通知事件发送方停止继续处理。</p>
<p >例如，当我们用 <code>Reader</code> 解析一个 JSON 时，处理器检测到该 JSON 并不符合所需的 schema，那么处理器可以返回 <code>false</code>，令 <code>Reader</code> 停止之后的解析工作。而 <code>Reader</code> 会进入一个错误状态，并以 <code>kParseErrorTermination</code> 错误码标识。</p>
<h2><a class="anchor" id="GenericReader"></a>
GenericReader</h2>
<p >前面提及，<code>Reader</code> 是 <code><a class="el" href="class_generic_reader.html" title="SAX-style JSON parser. Use Reader for UTF8 encoding and default allocator.">GenericReader</a></code> 模板类的 typedef：</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SourceEncoding, <span class="keyword">typename</span> TargetEncoding, <span class="keyword">typename</span> Allocator = MemoryPoolAllocator&lt;&gt; &gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_generic_reader.html">GenericReader</a> {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <a class="code hl_class" href="class_generic_reader.html">GenericReader&lt;UTF8&lt;&gt;</a>, <a class="code hl_struct" href="struct_u_t_f8.html">UTF8&lt;&gt;</a> &gt; <a class="code hl_typedef" href="fwd_8h.html#ab7f1c1207749ff25c0d7f0cc88e62788">Reader</a>;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace rapidjson</span></div>
<div class="ttc" id="afwd_8h_html_ab7f1c1207749ff25c0d7f0cc88e62788"><div class="ttname"><a href="fwd_8h.html#ab7f1c1207749ff25c0d7f0cc88e62788">Reader</a></div><div class="ttdeci">GenericReader&lt; UTF8&lt; char &gt;, UTF8&lt; char &gt;, CrtAllocator &gt; Reader</div><div class="ttdef"><b>Definition:</b> fwd.h:88</div></div>
<div class="ttc" id="astruct_u_t_f8_html"><div class="ttname"><a href="struct_u_t_f8.html">UTF8</a></div><div class="ttdoc">UTF-8 encoding.</div><div class="ttdef"><b>Definition:</b> encodings.h:96</div></div>
</div><!-- fragment --><p ><code>Reader</code> 使用 UTF-8 作为来源及目标编码。来源编码是指 JSON 流的编码。目标编码是指 <code>String()</code> 的 <code>str</code> 参数所用的编码。例如，要解析一个 UTF-8 流并输出至 UTF-16 string 事件，你需要这么定义一个 reader：</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_generic_reader.html">GenericReader&lt;UTF8&lt;&gt;</a>, <a class="code hl_struct" href="struct_u_t_f16.html">UTF16&lt;&gt;</a> &gt; reader;</div>
<div class="ttc" id="astruct_u_t_f16_html"><div class="ttname"><a href="struct_u_t_f16.html">UTF16</a></div><div class="ttdoc">UTF-16 encoding.</div><div class="ttdef"><b>Definition:</b> encodings.h:269</div></div>
</div><!-- fragment --><p >注意到 <code><a class="el" href="struct_u_t_f16.html" title="UTF-16 encoding.">UTF16</a></code> 的缺省类型是 <code>wchar_t</code>。因此这个 <code>reader</code> 需要调用处理器的 <code>String(const wchar_t*, SizeType, bool)</code>。</p>
<p >第三个模板参数 <code>Allocator</code> 是内部数据结构（实际上是一个堆栈）的分配器类型。</p>
<h2><a class="anchor" id="SaxParsing"></a>
Parsing</h2>
<p ><code>Reader</code> 的唯一功能就是解析 JSON。</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">unsigned</span> parseFlags, <span class="keyword">typename</span> InputStream, <span class="keyword">typename</span> Handler&gt;</div>
<div class="line"><span class="keywordtype">bool</span> Parse(InputStream&amp; is, <a class="code hl_class" href="classrapidjson_1_1_handler.html">Handler</a>&amp; handler);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 使用 parseFlags = kDefaultParseFlags</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> InputStream, <span class="keyword">typename</span> Handler&gt;</div>
<div class="line"><span class="keywordtype">bool</span> Parse(InputStream&amp; is, <a class="code hl_class" href="classrapidjson_1_1_handler.html">Handler</a>&amp; handler);</div>
</div><!-- fragment --><p >若在解析中出现错误，它会返回 <code>false</code>。使用者可调用 <code>bool HasParseEror()</code>, <code>ParseErrorCode GetParseErrorCode()</code> 及 <code>size_t GetErrorOffset()</code> 获取错误状态。实际上 <code>Document</code> 使用这些 <code>Reader</code> 函数去获取解析错误。请参考 <a class="el" href="dom_8zh-cn_8md.html">DOM</a> 去了解有关解析错误的细节。</p>
<h1><a class="anchor" id="Writer"></a>
Writer</h1>
<p ><code>Reader</code> 把 JSON 转换（解析）成为事件。<code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 做完全相反的事情。它把事件转换成 JSON。</p>
<p ><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 是非常容易使用的。若你的应用程序只需把一些数据转换成 JSON，可能直接使用 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code>，会比建立一个 <code>Document</code> 然后用 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 把它转换成 JSON 更加方便。</p>
<p >在 <code>simplewriter</code> 例子里，我们做 <code>simplereader</code> 完全相反的事情。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="writer_8h.html">rapidjson/writer.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="stringbuffer_8h.html">rapidjson/stringbuffer.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a>;</div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">    <a class="code hl_class" href="class_generic_string_buffer.html">StringBuffer</a> s;</div>
<div class="line">    <a class="code hl_class" href="class_writer.html">Writer&lt;StringBuffer&gt;</a> writer(s);</div>
<div class="line">    </div>
<div class="line">    writer.StartObject();</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line">    writer.String(<span class="stringliteral">&quot;world&quot;</span>);</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line">    writer.Bool(<span class="keyword">true</span>);</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;f&quot;</span>);</div>
<div class="line">    writer.Bool(<span class="keyword">false</span>);</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;n&quot;</span>);</div>
<div class="line">    writer.Null();</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;i&quot;</span>);</div>
<div class="line">    writer.Uint(123);</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;pi&quot;</span>);</div>
<div class="line">    writer.Double(3.1416);</div>
<div class="line">    writer.Key(<span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">    writer.StartArray();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; 4; i++)</div>
<div class="line">        writer.Uint(i);</div>
<div class="line">    writer.EndArray();</div>
<div class="line">    writer.EndObject();</div>
<div class="line"> </div>
<div class="line">    cout &lt;&lt; s.<a class="code hl_function" href="class_generic_string_buffer.html#a42079865bab1deb930c6cff7d491c719">GetString</a>() &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclass_generic_string_buffer_html"><div class="ttname"><a href="class_generic_string_buffer.html">GenericStringBuffer&lt; UTF8&lt; char &gt;, CrtAllocator &gt;</a></div></div>
<div class="ttc" id="aclass_generic_string_buffer_html_a42079865bab1deb930c6cff7d491c719"><div class="ttname"><a href="class_generic_string_buffer.html#a42079865bab1deb930c6cff7d491c719">GenericStringBuffer::GetString</a></div><div class="ttdeci">const Ch * GetString() const</div><div class="ttdef"><b>Definition:</b> stringbuffer.h:73</div></div>
<div class="ttc" id="aclass_writer_html"><div class="ttname"><a href="class_writer.html">Writer</a></div><div class="ttdoc">JSON writer.</div><div class="ttdef"><b>Definition:</b> writer.h:90</div></div>
<div class="ttc" id="astringbuffer_8h_html"><div class="ttname"><a href="stringbuffer_8h.html">stringbuffer.h</a></div></div>
<div class="ttc" id="awriter_8h_html"><div class="ttname"><a href="writer_8h.html">writer.h</a></div></div>
</div><!-- fragment --><div class="fragment"><div class="line">{&quot;hello&quot;:&quot;world&quot;,&quot;t&quot;:true,&quot;f&quot;:false,&quot;n&quot;:null,&quot;i&quot;:123,&quot;pi&quot;:3.1416,&quot;a&quot;:[0,1,2,3]}</div>
</div><!-- fragment --><p ><code>String()</code> 及 <code>Key()</code> 各有两个重载。一个是如处理器 concept 般，有 3 个参数。它能处理含空字符的字符串。另一个是如上中使用的较简单版本。</p>
<p >注意到，例子代码中的 <code>EndArray()</code> 及 <code>EndObject()</code> 并没有参数。可以传递一个 <code>SizeType</code> 的参数，但它会被 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 忽略。</p>
<p >你可能会怀疑，为什么不使用 <code>sprintf()</code> 或 <code>std::stringstream</code> 去建立一个 JSON？</p>
<p >这有几个原因：</p><ol type="1">
<li><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 必然会输出一个结构良好（well-formed）的 JSON。若然有错误的事件次序（如 <code>Int()</code> 紧随 <code>StartObject()</code> 出现），它会在调试模式中产生断言失败。</li>
<li><code><a class="el" href="class_writer.html#a8b4dc44f471403a83c9959575796ceab">Writer::String()</a></code> 可处理字符串转义（如把码点 <code>U+000A</code> 转换成 <code>\n</code>）及进行 Unicode 转码。</li>
<li><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 一致地处理 number 的输出。</li>
<li><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 实现了事件处理器 concept。可用于处理来自 <code>Reader</code>、<code>Document</code> 或其他事件发生器。</li>
<li><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 可对不同平台进行优化。</li>
</ol>
<p >无论如何，使用 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> API 去生成 JSON 甚至乎比这些临时方法更简单。</p>
<h2><a class="anchor" id="WriterTemplate"></a>
Template</h2>
<p ><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 与 <code>Reader</code> 有少许设计区别。<code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 是一个模板类，而不是一个 typedef。 并没有 <code>GenericWriter</code>。以下是 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 的声明。</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> OutputStream, <span class="keyword">typename</span> SourceEncoding = UTF8&lt;&gt;, <span class="keyword">typename</span> TargetEncoding = UTF8&lt;&gt;, <span class="keyword">typename</span> Allocator = CrtAllocator&lt;&gt; &gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_writer.html">Writer</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code hl_class" href="class_writer.html">Writer</a>(OutputStream&amp; os, <a class="code hl_class" href="classrapidjson_1_1_allocator.html">Allocator</a>* allocator = 0, <span class="keywordtype">size_t</span> levelDepth = kDefaultLevelDepth)</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace rapidjson</span></div>
<div class="ttc" id="aclassrapidjson_1_1_allocator_html"><div class="ttname"><a href="classrapidjson_1_1_allocator.html">Allocator</a></div><div class="ttdoc">Concept for allocating, resizing and freeing memory block.</div></div>
</div><!-- fragment --><p ><code>OutputStream</code> 模板参数是输出流的类型。它的类型不可以被自动推断，必须由使用者提供。</p>
<p ><code>SourceEncoding</code> 模板参数指定了 <code>String(const Ch*, ...)</code> 的编码。</p>
<p ><code>TargetEncoding</code> 模板参数指定输出流的编码。</p>
<p ><code>Allocator</code> 是分配器的类型，用于分配内部数据结构（一个堆栈）。</p>
<p ><code>writeFlags</code> 是以下位标志的组合：</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">写入位标志   </th><th class="markdownTableHeadNone">意义    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>kWriteNoFlags</code>   </td><td class="markdownTableBodyNone">没有任何标志。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>kWriteDefaultFlags</code>   </td><td class="markdownTableBodyNone">缺省的解析选项。它等于 <code>RAPIDJSON_WRITE_DEFAULT_FLAGS</code> 宏，此宏定义为 <code>kWriteNoFlags</code>。    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>kWriteValidateEncodingFlag</code>   </td><td class="markdownTableBodyNone">校验 JSON 字符串的编码。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>kWriteNanAndInfFlag</code>   </td><td class="markdownTableBodyNone">容许写入 <code>Infinity</code>, <code>-Infinity</code> 及 <code>NaN</code>。   </td></tr>
</table>
<p >此外，<code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 的构造函数有一 <code>levelDepth</code> 参数。存储每层阶信息的初始内存分配量受此参数影响。</p>
<h2><a class="anchor" id="PrettyWriter"></a>
PrettyWriter</h2>
<p ><code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 所输出的是没有空格字符的最紧凑 JSON，适合网络传输或储存，但不适合人类阅读。</p>
<p >因此，RapidJSON 提供了一个 <code><a class="el" href="class_pretty_writer.html" title="Writer with indentation and spacing.">PrettyWriter</a></code>，它在输出中加入缩进及换行。</p>
<p ><code><a class="el" href="class_pretty_writer.html" title="Writer with indentation and spacing.">PrettyWriter</a></code> 的用法与 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 几乎一样，不同之处是 <code><a class="el" href="class_pretty_writer.html" title="Writer with indentation and spacing.">PrettyWriter</a></code> 提供了一个 <code>SetIndent(Ch indentChar, unsigned indentCharCount)</code> 函数。缺省的缩进是 4 个空格。</p>
<h2><a class="anchor" id="CompletenessReset"></a>
Completeness and Reset</h2>
<p >一个 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 只可输出单个 JSON，其根节点可以是任何 JSON 类型。当处理完单个根节点事件（如 <code>String()</code>），或匹配的最后 <code>EndObject()</code> 或 <code>EndArray()</code> 事件，输出的 JSON 是结构完整（well-formed）及完整的。使用者可调用 <code><a class="el" href="class_writer.html#a07d74d36dd3191b06e0aab678c246157" title="Checks whether the output is a complete JSON.">Writer::IsComplete()</a></code> 去检测完整性。</p>
<p >当 JSON 完整时，<code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 不能再接受新的事件。不然其输出便会是不合法的（例如有超过一个根节点）。为了重新利用 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 对象，使用者可调用 <code><a class="el" href="class_writer.html#a8b53e8f137f7fcf694f5500711b3f58d" title="Reset the writer with a new stream.">Writer::Reset(OutputStream&amp; os)</a></code> 去重置其所有内部状态及设置新的输出流。</p>
<h1><a class="anchor" id="SaxTechniques"></a>
Techniques</h1>
<h2><a class="anchor" id="CustomDataStructure"></a>
Parsing JSON to Custom Data Structure</h2>
<p ><code>Document</code> 的解析功能完全依靠 <code>Reader</code>。实际上 <code>Document</code> 是一个处理器，在解析 JSON 时接收事件去建立一个 DOM。</p>
<p >使用者可以直接使用 <code>Reader</code> 去建立其他数据结构。这消除了建立 DOM 的步骤，从而减少了内存开销并改善性能。</p>
<p >在以下的 <code>messagereader</code> 例子中，<code>ParseMessages()</code> 解析一个 JSON，该 JSON 应该是一个含键值对的 object。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reader_8h.html">rapidjson/reader.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="en_8h.html">rapidjson/error/en.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> map&lt;string, string&gt; <a class="code hl_typedef" href="messagereader_8cpp.html#ae2c5980b5eb04369faa7f72447e6d664">MessageMap</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="struct_message_handler.html">MessageHandler</a></div>
<div class="line">    : <span class="keyword">public</span> <a class="code hl_struct" href="struct_base_reader_handler.html">BaseReaderHandler</a>&lt;UTF8&lt;&gt;, MessageHandler&gt; {</div>
<div class="line">    <a class="code hl_function" href="struct_message_handler.html#a4f6165a34fa3a4de7021e7e5cd7fd4f6">MessageHandler</a>() : <a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a>(<a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca43d4b1361a039d9a3223b2407ed5b506">kExpectObjectStart</a>) {</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_message_handler.html#a3d7e691831748287252e10ced02061f5">StartObject</a>() {</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a>) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca43d4b1361a039d9a3223b2407ed5b506">kExpectObjectStart</a>:</div>
<div class="line">            <a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a> = <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">kExpectNameOrObjectEnd</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_message_handler.html#ab9de0f0bd0666b805563cb3f86ef3fc0">String</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span>) {</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a>) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">kExpectNameOrObjectEnd</a>:</div>
<div class="line">            <a class="code hl_variable" href="struct_message_handler.html#a7a61cf6c752b8829eb9c058341617c69">name_</a> = string(str, length);</div>
<div class="line">            <a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a> = <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca6f46eb7d062c953ecb1a28a471908568">kExpectValue</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca6f46eb7d062c953ecb1a28a471908568">kExpectValue</a>:</div>
<div class="line">            <a class="code hl_variable" href="struct_message_handler.html#a628b5a49349a2027c84ffb4f6249fa51">messages_</a>.insert(MessageMap::value_type(<a class="code hl_variable" href="struct_message_handler.html#a7a61cf6c752b8829eb9c058341617c69">name_</a>, <span class="keywordtype">string</span>(str, length)));</div>
<div class="line">            <a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a> = <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">kExpectNameOrObjectEnd</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_message_handler.html#ab423864fd5ca806d4211c03acbdad67b">EndObject</a>(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a> == <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">kExpectNameOrObjectEnd</a>; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_message_handler.html#a3ab79ae50d26d5b3fb62a9bab58c21bb">Default</a>() { <span class="keywordflow">return</span> <span class="keyword">false</span>; } <span class="comment">// All other events are invalid.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="messagereader_8cpp.html#ae2c5980b5eb04369faa7f72447e6d664">MessageMap</a> <a class="code hl_variable" href="struct_message_handler.html#a628b5a49349a2027c84ffb4f6249fa51">messages_</a>;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code hl_enumeration" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2c">State</a> {</div>
<div class="line">        <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca43d4b1361a039d9a3223b2407ed5b506">kExpectObjectStart</a>,</div>
<div class="line">        <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">kExpectNameOrObjectEnd</a>,</div>
<div class="line">        <a class="code hl_enumvalue" href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca6f46eb7d062c953ecb1a28a471908568">kExpectValue</a>,</div>
<div class="line">    }<a class="code hl_variable" href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">state_</a>;</div>
<div class="line">    std::string <a class="code hl_variable" href="struct_message_handler.html#a7a61cf6c752b8829eb9c058341617c69">name_</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ParseMessages(<span class="keyword">const</span> <span class="keywordtype">char</span>* json, <a class="code hl_typedef" href="messagereader_8cpp.html#ae2c5980b5eb04369faa7f72447e6d664">MessageMap</a>&amp; messages) {</div>
<div class="line">    <a class="code hl_class" href="class_generic_reader.html">Reader</a> reader;</div>
<div class="line">    <a class="code hl_struct" href="struct_message_handler.html">MessageHandler</a> handler;</div>
<div class="line">    <a class="code hl_struct" href="struct_generic_string_stream.html">StringStream</a> ss(json);</div>
<div class="line">    <span class="keywordflow">if</span> (reader.<a class="code hl_function" href="class_generic_reader.html#a0c450620d14ff1824e58bb7bd9b42099">Parse</a>(ss, handler))</div>
<div class="line">        messages.swap(handler.<a class="code hl_variable" href="struct_message_handler.html#a628b5a49349a2027c84ffb4f6249fa51">messages_</a>);   <span class="comment">// Only change it if success.</span></div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_enumeration" href="group___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s.html#ga8d4b32dfc45840bca189ade2bbcb6ba7">ParseErrorCode</a> e = reader.<a class="code hl_function" href="class_generic_reader.html#a937bf90919f50e1c370b312cee5833e8">GetParseErrorCode</a>();</div>
<div class="line">        <span class="keywordtype">size_t</span> o = reader.<a class="code hl_function" href="class_generic_reader.html#ae9008523ccd06d839a57335835cb4091">GetErrorOffset</a>();</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; <a class="code hl_function" href="group___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s.html#ga28835eb93d2c3c07bbea13515eb31415">GetParseError_En</a>(e) &lt;&lt; endl;;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot; at offset &quot;</span> &lt;&lt; o &lt;&lt; <span class="stringliteral">&quot; near &#39;&quot;</span> &lt;&lt; string(json).substr(o, 10) &lt;&lt; <span class="stringliteral">&quot;...&#39;&quot;</span> &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>() {</div>
<div class="line">    <a class="code hl_typedef" href="messagereader_8cpp.html#ae2c5980b5eb04369faa7f72447e6d664">MessageMap</a> messages;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* json1 = <span class="stringliteral">&quot;{ \&quot;greeting\&quot; : \&quot;Hello!\&quot;, \&quot;farewell\&quot; : \&quot;bye-bye!\&quot; }&quot;</span>;</div>
<div class="line">    cout &lt;&lt; json1 &lt;&lt; endl;</div>
<div class="line">    ParseMessages(json1, messages);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (MessageMap::const_iterator itr = messages.begin(); itr != messages.end(); ++itr)</div>
<div class="line">        cout &lt;&lt; itr-&gt;first &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; itr-&gt;second &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">    cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;Parse a JSON with invalid schema.&quot;</span> &lt;&lt; endl;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* json2 = <span class="stringliteral">&quot;{ \&quot;greeting\&quot; : \&quot;Hello!\&quot;, \&quot;farewell\&quot; : \&quot;bye-bye!\&quot;, \&quot;foo\&quot; : {} }&quot;</span>;</div>
<div class="line">    cout &lt;&lt; json2 &lt;&lt; endl;</div>
<div class="line">    ParseMessages(json2, messages);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclass_generic_reader_html_a937bf90919f50e1c370b312cee5833e8"><div class="ttname"><a href="class_generic_reader.html#a937bf90919f50e1c370b312cee5833e8">GenericReader::GetParseErrorCode</a></div><div class="ttdeci">ParseErrorCode GetParseErrorCode() const</div><div class="ttdoc">Get the ParseErrorCode of last parsing.</div><div class="ttdef"><b>Definition:</b> reader.h:685</div></div>
<div class="ttc" id="aclass_generic_reader_html_ae9008523ccd06d839a57335835cb4091"><div class="ttname"><a href="class_generic_reader.html#ae9008523ccd06d839a57335835cb4091">GenericReader::GetErrorOffset</a></div><div class="ttdeci">size_t GetErrorOffset() const</div><div class="ttdoc">Get the position of last parsing error in input, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> reader.h:688</div></div>
<div class="ttc" id="aen_8h_html"><div class="ttname"><a href="en_8h.html">en.h</a></div></div>
<div class="ttc" id="agroup___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s_html_ga28835eb93d2c3c07bbea13515eb31415"><div class="ttname"><a href="group___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s.html#ga28835eb93d2c3c07bbea13515eb31415">GetParseError_En</a></div><div class="ttdeci">RAPIDJSON_NAMESPACE_BEGIN const RAPIDJSON_ERROR_CHARTYPE * GetParseError_En(ParseErrorCode parseErrorCode)</div><div class="ttdoc">Maps error code of parsing into error message.</div><div class="ttdef"><b>Definition:</b> en.h:36</div></div>
<div class="ttc" id="agroup___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s_html_ga8d4b32dfc45840bca189ade2bbcb6ba7"><div class="ttname"><a href="group___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s.html#ga8d4b32dfc45840bca189ade2bbcb6ba7">ParseErrorCode</a></div><div class="ttdeci">ParseErrorCode</div><div class="ttdoc">Error code of parsing.</div><div class="ttdef"><b>Definition:</b> error.h:64</div></div>
<div class="ttc" id="amessagereader_8cpp_html_ae2c5980b5eb04369faa7f72447e6d664"><div class="ttname"><a href="messagereader_8cpp.html#ae2c5980b5eb04369faa7f72447e6d664">MessageMap</a></div><div class="ttdeci">map&lt; string, string &gt; MessageMap</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:13</div></div>
<div class="ttc" id="astruct_message_handler_html"><div class="ttname"><a href="struct_message_handler.html">MessageHandler</a></div><div class="ttdef"><b>Definition:</b> messagereader.cpp:26</div></div>
<div class="ttc" id="astruct_message_handler_html_a3ab79ae50d26d5b3fb62a9bab58c21bb"><div class="ttname"><a href="struct_message_handler.html#a3ab79ae50d26d5b3fb62a9bab58c21bb">MessageHandler::Default</a></div><div class="ttdeci">bool Default()</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:56</div></div>
<div class="ttc" id="astruct_message_handler_html_a3d7e691831748287252e10ced02061f5"><div class="ttname"><a href="struct_message_handler.html#a3d7e691831748287252e10ced02061f5">MessageHandler::StartObject</a></div><div class="ttdeci">bool StartObject()</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:29</div></div>
<div class="ttc" id="astruct_message_handler_html_a4f6165a34fa3a4de7021e7e5cd7fd4f6"><div class="ttname"><a href="struct_message_handler.html#a4f6165a34fa3a4de7021e7e5cd7fd4f6">MessageHandler::MessageHandler</a></div><div class="ttdeci">MessageHandler()</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:27</div></div>
<div class="ttc" id="astruct_message_handler_html_a628b5a49349a2027c84ffb4f6249fa51"><div class="ttname"><a href="struct_message_handler.html#a628b5a49349a2027c84ffb4f6249fa51">MessageHandler::messages_</a></div><div class="ttdeci">MessageMap messages_</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:58</div></div>
<div class="ttc" id="astruct_message_handler_html_a704e2a1bc5f7a4644998112cba61db2c"><div class="ttname"><a href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2c">MessageHandler::State</a></div><div class="ttdeci">State</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:59</div></div>
<div class="ttc" id="astruct_message_handler_html_a704e2a1bc5f7a4644998112cba61db2ca43d4b1361a039d9a3223b2407ed5b506"><div class="ttname"><a href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca43d4b1361a039d9a3223b2407ed5b506">MessageHandler::kExpectObjectStart</a></div><div class="ttdeci">@ kExpectObjectStart</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:60</div></div>
<div class="ttc" id="astruct_message_handler_html_a704e2a1bc5f7a4644998112cba61db2ca6f46eb7d062c953ecb1a28a471908568"><div class="ttname"><a href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca6f46eb7d062c953ecb1a28a471908568">MessageHandler::kExpectValue</a></div><div class="ttdeci">@ kExpectValue</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:62</div></div>
<div class="ttc" id="astruct_message_handler_html_a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db"><div class="ttname"><a href="struct_message_handler.html#a704e2a1bc5f7a4644998112cba61db2ca70008d18048772c50a2226a6e592c7db">MessageHandler::kExpectNameOrObjectEnd</a></div><div class="ttdeci">@ kExpectNameOrObjectEnd</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:61</div></div>
<div class="ttc" id="astruct_message_handler_html_a7a61cf6c752b8829eb9c058341617c69"><div class="ttname"><a href="struct_message_handler.html#a7a61cf6c752b8829eb9c058341617c69">MessageHandler::name_</a></div><div class="ttdeci">std::string name_</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:64</div></div>
<div class="ttc" id="astruct_message_handler_html_a927d3ae4618ed37e3904ff673fdd3768"><div class="ttname"><a href="struct_message_handler.html#a927d3ae4618ed37e3904ff673fdd3768">MessageHandler::state_</a></div><div class="ttdeci">enum MessageHandler::State state_</div></div>
<div class="ttc" id="astruct_message_handler_html_ab423864fd5ca806d4211c03acbdad67b"><div class="ttname"><a href="struct_message_handler.html#ab423864fd5ca806d4211c03acbdad67b">MessageHandler::EndObject</a></div><div class="ttdeci">bool EndObject(SizeType)</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:54</div></div>
<div class="ttc" id="astruct_message_handler_html_ab9de0f0bd0666b805563cb3f86ef3fc0"><div class="ttname"><a href="struct_message_handler.html#ab9de0f0bd0666b805563cb3f86ef3fc0">MessageHandler::String</a></div><div class="ttdeci">bool String(const char *str, SizeType length, bool)</div><div class="ttdef"><b>Definition:</b> messagereader.cpp:39</div></div>
</div><!-- fragment --><div class="fragment"><div class="line">{ &quot;greeting&quot; : &quot;Hello!&quot;, &quot;farewell&quot; : &quot;bye-bye!&quot; }</div>
<div class="line">farewell: bye-bye!</div>
<div class="line">greeting: Hello!</div>
<div class="line"> </div>
<div class="line">Parse a JSON with invalid schema.</div>
<div class="line">{ &quot;greeting&quot; : &quot;Hello!&quot;, &quot;farewell&quot; : &quot;bye-bye!&quot;, &quot;foo&quot; : {} }</div>
<div class="line">Error: Terminate parsing due to Handler error.</div>
<div class="line"> at offset 59 near &#39;} }...&#39;</div>
</div><!-- fragment --><p >第一个 JSON（<code>json1</code>）被成功地解析至 <code>MessageMap</code>。由于 <code>MessageMap</code> 是一个 <code>std::map</code>，打印次序按键值排序。此次序与 JSON 中的次序不同。</p>
<p >在第二个 JSON（<code>json2</code>）中，<code>foo</code> 的值是一个空 object。由于它是一个 object，<code><a class="el" href="struct_message_handler.html#a3d7e691831748287252e10ced02061f5">MessageHandler::StartObject()</a></code> 会被调用。然而，在 <code>state_ = kExpectValue</code> 的情况下，该函数会返回 <code>false</code>，并导致解析过程终止。错误代码是 <code>kParseErrorTermination</code>。</p>
<h2><a class="anchor" id="Filtering"></a>
Filtering of JSON</h2>
<p >如前面提及过，<code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 可处理 <code>Reader</code> 发出的事件。<code><a class="el" href="condense_8cpp.html">example/condense/condense.cpp</a></code> 例子简单地设置 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code> 作为一个 <code>Reader</code> 的处理器，因此它能移除 JSON 中的所有空白字符。<code><a class="el" href="pretty_8cpp.html">example/pretty/pretty.cpp</a></code> 例子使用同样的关系，只是以 <code><a class="el" href="class_pretty_writer.html" title="Writer with indentation and spacing.">PrettyWriter</a></code> 取代 <code><a class="el" href="class_writer.html" title="JSON writer.">Writer</a></code>。因此 <code>pretty</code> 能够重新格式化 JSON，加入缩进及换行。</p>
<p >实际上，我们可以使用 SAX 风格 API 去加入（多个）中间层去过滤 JSON 的内容。例如 <code>capitalize</code> 例子可以把所有 JSON string 改为大写。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="reader_8h.html">rapidjson/reader.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="writer_8h.html">rapidjson/writer.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="filereadstream_8h.html">rapidjson/filereadstream.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="filewritestream_8h.html">rapidjson/filewritestream.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="en_8h.html">rapidjson/error/en.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cctype&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacerapidjson.html">rapidjson</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> OutputHandler&gt;</div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="struct_capitalize_filter.html">CapitalizeFilter</a> {</div>
<div class="line">    <a class="code hl_function" href="struct_capitalize_filter.html#afe978f33a2f30a84a9e69cc91fe2da6d">CapitalizeFilter</a>(OutputHandler&amp; out) : <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>(out), <a class="code hl_variable" href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">buffer_</a>() {</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a8638839428a447d47711a4b367dc13a4">Null</a>() { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Null(); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a957038be10025563a35ad32ab9d78418">Bool</a>(<span class="keywordtype">bool</span> b) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Bool(b); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a5eec489885ed7f982ea66caf8d557210">Int</a>(<span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Int(i); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a0e1d475eec0129d65fd7b2c06878e445">Uint</a>(<span class="keywordtype">unsigned</span> u) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Uint(u); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a5ab3ec8eba2a56f595bf10e2f63c0446">Int64</a>(<a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> i) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Int64(i); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a603a8c709c0009d7b21dbb20a570bac7">Uint64</a>(<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> u) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Uint64(u); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a1c21df7948456b3ae679db9d1a190249">Double</a>(<span class="keywordtype">double</span> d) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.Double(d); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a471c199da18ca411550e703a6256abd8">RawNumber</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.RawNumber(str, length, copy); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a9888a3eadb5297cc06b76df470767b48">String</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span>) { </div>
<div class="line">        <a class="code hl_variable" href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">buffer_</a>.clear();</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> i = 0; i &lt; length; i++)</div>
<div class="line">            <a class="code hl_variable" href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">buffer_</a>.push_back(std::toupper(str[i]));</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.String(&amp;<a class="code hl_variable" href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">buffer_</a>.front(), length, <span class="keyword">true</span>); <span class="comment">// true = output handler need to copy the string</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#ab21677e0794b7414ff0fec27f6599095">StartObject</a>() { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.StartObject(); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#abe3c83f43cbb9ff7ff0e5fdabee79b21">Key</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> length, <span class="keywordtype">bool</span> copy) { <span class="keywordflow">return</span> <a class="code hl_function" href="struct_capitalize_filter.html#a9888a3eadb5297cc06b76df470767b48">String</a>(str, length, copy); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#aea1d83e92b986264e04314ea2259207d">EndObject</a>(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> memberCount) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.EndObject(memberCount); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#ac6c50b5828bb848fbc98b92c2f432e9f">StartArray</a>() { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.StartArray(); }</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="struct_capitalize_filter.html#a3d7092e115d0b3f0a277da8487eff4d4">EndArray</a>(<a class="code hl_variable" href="rapidjson_8h.html#a5ed6e6e67250fadbd041127e6386dcb5">SizeType</a> elementCount) { <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>.EndArray(elementCount); }</div>
<div class="line"> </div>
<div class="line">    OutputHandler&amp; <a class="code hl_variable" href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">out_</a>;</div>
<div class="line">    std::vector&lt;char&gt; <a class="code hl_variable" href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">buffer_</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="_c_make_c_compiler_id_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>*[]) {</div>
<div class="line">    <span class="comment">// Prepare JSON reader and input stream.</span></div>
<div class="line">    <a class="code hl_class" href="class_generic_reader.html">Reader</a> reader;</div>
<div class="line">    <span class="keywordtype">char</span> readBuffer[65536];</div>
<div class="line">    <a class="code hl_class" href="class_file_read_stream.html">FileReadStream</a> is(stdin, readBuffer, <span class="keyword">sizeof</span>(readBuffer));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Prepare JSON writer and output stream.</span></div>
<div class="line">    <span class="keywordtype">char</span> writeBuffer[65536];</div>
<div class="line">    <a class="code hl_class" href="class_file_write_stream.html">FileWriteStream</a> os(stdout, writeBuffer, <span class="keyword">sizeof</span>(writeBuffer));</div>
<div class="line">    <a class="code hl_class" href="class_writer.html">Writer&lt;FileWriteStream&gt;</a> writer(os);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// JSON reader parse from the input stream and let writer generate the output.</span></div>
<div class="line">    <a class="code hl_struct" href="struct_capitalize_filter.html">CapitalizeFilter&lt;Writer&lt;FileWriteStream&gt;</a> &gt; filter(writer);</div>
<div class="line">    <span class="keywordflow">if</span> (!reader.<a class="code hl_function" href="class_generic_reader.html#a0c450620d14ff1824e58bb7bd9b42099">Parse</a>(is, filter)) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;\nError(%u): %s\n&quot;</span>, (<span class="keywordtype">unsigned</span>)reader.<a class="code hl_function" href="class_generic_reader.html#ae9008523ccd06d839a57335835cb4091">GetErrorOffset</a>(), <a class="code hl_function" href="group___r_a_p_i_d_j_s_o_n___e_r_r_o_r_s.html#ga28835eb93d2c3c07bbea13515eb31415">GetParseError_En</a>(reader.<a class="code hl_function" href="class_generic_reader.html#a937bf90919f50e1c370b312cee5833e8">GetParseErrorCode</a>()));</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclass_file_read_stream_html"><div class="ttname"><a href="class_file_read_stream.html">FileReadStream</a></div><div class="ttdoc">File byte stream for input using fread().</div><div class="ttdef"><b>Definition:</b> filereadstream.h:34</div></div>
<div class="ttc" id="aclass_file_write_stream_html"><div class="ttname"><a href="class_file_write_stream.html">FileWriteStream</a></div><div class="ttdoc">Wrapper of C file stream for output using fwrite().</div><div class="ttdef"><b>Definition:</b> filewritestream.h:32</div></div>
<div class="ttc" id="afilereadstream_8h_html"><div class="ttname"><a href="filereadstream_8h.html">filereadstream.h</a></div></div>
<div class="ttc" id="afilewritestream_8h_html"><div class="ttname"><a href="filewritestream_8h.html">filewritestream.h</a></div></div>
<div class="ttc" id="astruct_capitalize_filter_html"><div class="ttname"><a href="struct_capitalize_filter.html">CapitalizeFilter</a></div><div class="ttdef"><b>Definition:</b> capitalize.cpp:17</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a0e1d475eec0129d65fd7b2c06878e445"><div class="ttname"><a href="struct_capitalize_filter.html#a0e1d475eec0129d65fd7b2c06878e445">CapitalizeFilter::Uint</a></div><div class="ttdeci">bool Uint(unsigned u)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:23</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a1c21df7948456b3ae679db9d1a190249"><div class="ttname"><a href="struct_capitalize_filter.html#a1c21df7948456b3ae679db9d1a190249">CapitalizeFilter::Double</a></div><div class="ttdeci">bool Double(double d)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:26</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a3d7092e115d0b3f0a277da8487eff4d4"><div class="ttname"><a href="struct_capitalize_filter.html#a3d7092e115d0b3f0a277da8487eff4d4">CapitalizeFilter::EndArray</a></div><div class="ttdeci">bool EndArray(SizeType elementCount)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:38</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a471c199da18ca411550e703a6256abd8"><div class="ttname"><a href="struct_capitalize_filter.html#a471c199da18ca411550e703a6256abd8">CapitalizeFilter::RawNumber</a></div><div class="ttdeci">bool RawNumber(const char *str, SizeType length, bool copy)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:27</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a5ab3ec8eba2a56f595bf10e2f63c0446"><div class="ttname"><a href="struct_capitalize_filter.html#a5ab3ec8eba2a56f595bf10e2f63c0446">CapitalizeFilter::Int64</a></div><div class="ttdeci">bool Int64(int64_t i)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:24</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a5eec489885ed7f982ea66caf8d557210"><div class="ttname"><a href="struct_capitalize_filter.html#a5eec489885ed7f982ea66caf8d557210">CapitalizeFilter::Int</a></div><div class="ttdeci">bool Int(int i)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:22</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a603a8c709c0009d7b21dbb20a570bac7"><div class="ttname"><a href="struct_capitalize_filter.html#a603a8c709c0009d7b21dbb20a570bac7">CapitalizeFilter::Uint64</a></div><div class="ttdeci">bool Uint64(uint64_t u)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:25</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a6e05d2941c11423da2dbb3ab8eb2367d"><div class="ttname"><a href="struct_capitalize_filter.html#a6e05d2941c11423da2dbb3ab8eb2367d">CapitalizeFilter::buffer_</a></div><div class="ttdeci">std::vector&lt; char &gt; buffer_</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:41</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a76bff3d685698cd6ab2e4cbb84bbf011"><div class="ttname"><a href="struct_capitalize_filter.html#a76bff3d685698cd6ab2e4cbb84bbf011">CapitalizeFilter::out_</a></div><div class="ttdeci">OutputHandler &amp; out_</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:40</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a8638839428a447d47711a4b367dc13a4"><div class="ttname"><a href="struct_capitalize_filter.html#a8638839428a447d47711a4b367dc13a4">CapitalizeFilter::Null</a></div><div class="ttdeci">bool Null()</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:20</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a957038be10025563a35ad32ab9d78418"><div class="ttname"><a href="struct_capitalize_filter.html#a957038be10025563a35ad32ab9d78418">CapitalizeFilter::Bool</a></div><div class="ttdeci">bool Bool(bool b)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:21</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_a9888a3eadb5297cc06b76df470767b48"><div class="ttname"><a href="struct_capitalize_filter.html#a9888a3eadb5297cc06b76df470767b48">CapitalizeFilter::String</a></div><div class="ttdeci">bool String(const char *str, SizeType length, bool)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:28</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_ab21677e0794b7414ff0fec27f6599095"><div class="ttname"><a href="struct_capitalize_filter.html#ab21677e0794b7414ff0fec27f6599095">CapitalizeFilter::StartObject</a></div><div class="ttdeci">bool StartObject()</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:34</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_abe3c83f43cbb9ff7ff0e5fdabee79b21"><div class="ttname"><a href="struct_capitalize_filter.html#abe3c83f43cbb9ff7ff0e5fdabee79b21">CapitalizeFilter::Key</a></div><div class="ttdeci">bool Key(const char *str, SizeType length, bool copy)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:35</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_ac6c50b5828bb848fbc98b92c2f432e9f"><div class="ttname"><a href="struct_capitalize_filter.html#ac6c50b5828bb848fbc98b92c2f432e9f">CapitalizeFilter::StartArray</a></div><div class="ttdeci">bool StartArray()</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:37</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_aea1d83e92b986264e04314ea2259207d"><div class="ttname"><a href="struct_capitalize_filter.html#aea1d83e92b986264e04314ea2259207d">CapitalizeFilter::EndObject</a></div><div class="ttdeci">bool EndObject(SizeType memberCount)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:36</div></div>
<div class="ttc" id="astruct_capitalize_filter_html_afe978f33a2f30a84a9e69cc91fe2da6d"><div class="ttname"><a href="struct_capitalize_filter.html#afe978f33a2f30a84a9e69cc91fe2da6d">CapitalizeFilter::CapitalizeFilter</a></div><div class="ttdeci">CapitalizeFilter(OutputHandler &amp;out)</div><div class="ttdef"><b>Definition:</b> capitalize.cpp:18</div></div>
</div><!-- fragment --><p >注意到，不可简单地把 JSON 当作字符串去改为大写。例如： </p><div class="fragment"><div class="line">[&quot;Hello\nWorld&quot;]</div>
</div><!-- fragment --><p >简单地把整个 JSON 转为大写的话会产生错误的转义符： </p><div class="fragment"><div class="line">[&quot;HELLO\NWORLD&quot;]</div>
</div><!-- fragment --><p >而 <code>capitalize</code> 就会产生正确的结果： </p><div class="fragment"><div class="line">[&quot;HELLO\nWORLD&quot;]</div>
</div><!-- fragment --><p >我们还可以开发更复杂的过滤器。然而，由于 SAX 风格 API 在某一时间点只能提供单一事件的信息，使用者需要自行记录一些上下文信息（例如从根节点起的路径、储存其他相关值）。对于处理某些情况，用 DOM 会比 SAX 更容易实现。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
